# minishell

   Компоненты оболочки Linux
   
   Оболочка-это сложная часть программного обеспечения, содержащая множество различных частей.
   
   Основной частью любой оболочки Linux является интерпретатор командной строки, или CLI. Эта часть служит двум целям: она читает и анализирует пользовательские команды, а затем выполняет проанализированные команды. Вы можете думать о самом CLI как о двух частях: синтаксическом анализаторе (или front-end) и исполнителе (или back-end).
   
   Анализатор сканирует входные данные и разбивает их на маркеры. Токен состоит из одного или нескольких символов (букв, цифр, символов) и представляет собой единую единицу ввода. Например, токен может быть именем переменной, ключевым словом, числом или арифметическим оператором.
   
   Синтаксический анализатор берет эти маркеры, группирует их вместе и создает специальную структуру, которую мы называем абстрактным синтаксическим деревом, или AST.
   
   Вы можете думать о AST как о высокоуровневом представлении командной строки, которую вы дали оболочке. Синтаксический анализатор принимает AST и передает его исполнителю, который считывает AST и выполняет проанализированную команду.
   
   Другой частью оболочки является пользовательский интерфейс, который обычно работает, когда оболочка находится в интерактивном режиме, например, когда вы вводите команды в командной строке оболочки. Здесь оболочка работает в цикле, который мы знаем как цикл Read-Eval-Print, или REPL. Как следует из названия цикла, оболочка считывает входные данные, анализирует и выполняет их, затем выполняет цикл для чтения следующей команды и так далее, пока вы не введете команду, такую как выход, завершение работы или перезагрузка.
   
   Большинство оболочек реализуют структуру, известную как таблица символов, которая используется оболочкой для хранения информации о переменных, а также их значений и атрибутов. Мы реализуем таблицу символов в Части II этого руководства.
   
   Оболочки Linux также имеют средство истории, которое позволяет пользователю получить доступ к самым последним введенным командам, а затем редактировать и повторно выполнять команды без особого набора текста. Оболочка также может содержать встроенные утилиты, которые представляют собой специальный набор команд, реализуемых как часть самой программы оболочки. Встроенные утилиты включают обычно используемые команды, такие как cd, fg и bg. Мы будем реализовывать многие из встроенных утилит по мере продвижения этого урока.
   
   Теперь, когда мы знаем основные компоненты типичной оболочки Linux, давайте начнем строить нашу собственную оболочку.
   
   Наш Первый Shell
   
   Наша первая версия оболочки не будет делать ничего необычного; она просто напечатает строку запроса, прочитает строку ввода, а затем эхом вернет ввод обратно на экран. В последующих частях этого урока мы добавим возможность анализировать и выполнять команды, циклы, условные выражения и многое другое.
   
   Давайте начнем с создания каталога для этого проекта. Обычно я использую ~/projects/ для своих проектов, но не стесняйтесь использовать любой путь, который вам удобен.
   
   Первое, что мы сделаем, это напишем наш базовый цикл REPL. Создайте файл с именем main.c (используя touch main.c), затем откройте его с помощью вашего любимого текстового редактора. Введите следующий код в свой main.c:

   #include <stdio.h>
   #include <stdlib.h>
   #include <errno.h>
   #include <string.h>
   #include "shell.h"
   int main(int argc, char **argv)
   {
      char *cmd;
      do
      {
         print_prompt1();
         cmd = read_cmd();
         if(!cmd)
         {
               exit(EXIT_SUCCESS);
         }
         if(cmd[0] == '\0' || strcmp(cmd, "\n") == 0)
         {
               free(cmd);
               continue;
         }
         if(strcmp(cmd, "exit\n") == 0)
         {
               free(cmd);
               break;
         }
         printf("%s\n", cmd);
         free(cmd);
      } while(1);
      exit(EXIT_SUCCESS);
   }
